<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>rp</title>
    <link rel="stylesheet" href="../../css/vendor/bulma/bulma.css">
    <link rel="stylesheet" href="../../css/vendor/effeckt/animations.css">
    <script src="/set_node_modules_path.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
<div ic-view-stage ic-ctrl="mainCtrl">

    ${ require('../tags/set-tag.html') }

    <div ic-view="todoList" ic-active ic-ctrl="todoListCtrl">
        <div class="column">

            <div ic-tpl="types" style="padding-bottom: 0.75rem;">
                <!--<button class="button is-primary" ic-click="refreshTags">刷新Tags</button>-->
                <div class="buttons is-centered" ic-select="tags" ic-select-auto="false" ic-select-cla="is-primary"
                     ic-has-selected="v==model.filterByType" ic-select-on-change="onFilterKeyChange">

                    <button class="button is-primary is-small" ic-click="addTodo">新Item</button>

                    <button ic-for="v,i in model.mapByType" ic-select-item ic-val="{{ v }}"
                            ic-class="button is-small {{ v==model.filterByType?'is-primary':''  }}">
                        {{ RPMQS_MAP[v] }}
                    </button>
                </div>
            </div>

            <div ic-tpl="todoList">
                <div ic-form>
                    <ul>
                        <li class="box" ic-for="i,v in model" data-id="{{ v.id }}" id="{{ 'k'+v.id }}" draggable="true" ic-dragstart="dragstart"
                            ic-drop="drop" ic-dragover="dragover" ic-dragleave="dragleave">

                            <h3>{{ v.title }} <b> {{ v.comment }}</b></h3>

                            <div class="wrap">
                                <div class="tags" ic-if="v.tags && v.tags.length" ic-select ic-select-type="checkbox" ic-form-field="{{ 'f_'+v.id }}">
                                    <span class="tag is-large" ic-for="j,k in v.tags" ic-select-item ic-val="{{ k }}">
                                        {{ TAGS_MAP_BY_ID[k].text }}
                                    </span>
                                </div>

                                <div class="pre text" ic-dblclick="toggle">{{ v.content }}</div>

                                <div>
                                    <div class="tags is-right">
                                        <span class="tag is-small"> {{ v.type }}</span>
                                        <span class="tag is-small" ic-click="edit:{{ v.id }}">修改</span>
                                        <span class="tag is-small" ic-click="focus:{{ v.id }}">置顶</span>
                                        <span class="tag is-small"
                                              ic-ajax
                                              ic-submit-method="delete"
                                              ic-submit-action="/stock/rp/{{v.id}}"
                                              ic-submit-before="delBeforeConfirm"
                                              ic-submit-on-done="onDelDone">删除</span>
                                    </div>
                                </div>
                            </div>

                        </li>
                    </ul>
                </div>
            </div>

        </div>
    </div>

    <div ic-view="setTodo" ic-ctrl="setTodoCtrl">
        <div class="column">
            <div ic-tpl="setTodo" ic-tpl-init="{}">
                <div ic-form>

                    <div class="field has-addons">
                        <div class="control">
                            <button class="button is-info">标题</button>
                        </div>
                        <div class="control is-expanded">
                            <input class="input" type="text" placeholder="Text input" value="{{ model.title }}" ic-form-field="title">
                            <input type="hidden" value="{{ model.id }}" ic-form-field="id">
                        </div>
                        <p class="control">
                            <span class="select">
                              <select name="type" ic-form-field>
                                  <option ic-for="i,o in TAGS_MAP['rpmqs']" value="{{o.key}}" ic-has-selected="o.key==model.type">
                                      {{ o.text }}
                                  </option>
                                  <!-- <option value="rp" ic-has-selected="'rp'==model.type">复盘&计划</option>
                                   <option value="question" ic-has-selected="'question'==model.type">问题</option>
                                   <option value="mistake" ic-has-selected="'mistake'==model.type">错误</option>
                                   <option value="warn" ic-has-selected="'warn'==model.type">警告</option>
                                   <option value="idea" ic-has-selected="'idea'==model.type">理念</option>
                                   <option value="市场" ic-has-selected="'市场'==model.type">市场</option>-->
                              </select>
                            </span>
                        </p>
                    </div>

                    <div class="field has-addons">
                        <div class="control">
                            <button class="button is-info">备注</button>
                        </div>
                        <div class="control is-expanded">
                            <input class="input" type="text" placeholder="Text input" value="{{ model.comment }}" ic-form-field="comment">
                        </div>
                    </div>

                    <div class="field is-grouped is-grouped-multiline" ic-select="items" ic-select-type="checkbox" ic-form-field="tags">
                        <div class="control" ic-for="i,v in model.tags">
                            <div class="tags has-addons">
                            <span class="tag is-medium" ic-select-item ic-val="{{ v }}" selected>
                                {{ TAGS_MAP_BY_ID[v].text }}
                            </span>
                            </div>
                        </div>

                        <p class="control">
                            <button class="button is-primary is-fullwidth" ic-view-to="tags">
                                添加新项
                            </button>
                        </p>
                    </div>

                    <div class="field">
                        <div class="control">
                            <button class="button is-primary"
                                    ic-form-submit
                                    ic-submit-action="/stock/rp"
                                    ic-submit-before="before"
                                    ic-submit-on-done="done">保存
                            </button>
                            <button class="button" ic-click="reset">
                                重置
                            </button>
                            <button class="button" ic-click="cancel">取消</button>
                            <button class="button" ic-view-to="todoList">
                                返回
                            </button>
                        </div>
                    </div>

                    <div class="field">
                        <div class="control">
                            <textarea id="editor" rows="14" class="textarea" placeholder="内容" ic-form-field="content"></textarea>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div ic-view="tags" ic-ctrl="tagsCtrl">
        <div class="column">

            <div class="buttons">
                <button class="button is-primary is-fullwidth" ic-view-to="setTodo">返回</button>
            </div>

            <div class="box" ic-tpl="tags">

                <div class="ic-select" ic-select="tags" ic-select-type="checkbox" ic-select-auto="false" ic-select-on-change="onChange">

                    <div class="field is-grouped is-grouped-multiline">

                        <div class="control" ic-for-start="k,arr in model.tags" ic-if-start="k!=='type'">
                            <span class="button is-primary">{{ k }}</span>
                        </div>

                        <div class="control" ic-for="i,v in arr">
                            <div class="tags has-addons">
                                <span class="tag is-medium is-black" ic-select-item ic-val="{{ v.id }}"
                                      ic-has-selected="model.rp.tags && model.rp.tags.includes(v.id)"> {{v.text}}</span>

                                <a class="tag is-medium" ic-click="editTag:{{v.id}}">
                                    <span class="icon is-medium"><i class="far fa-edit"></i></span>
                                </a>

                                <!--<a class="tag is-delete is-medium" ic-click="delTag:{{ v.id }}"></a>-->
                            </div>
                        </div>

                        <div class="control" ic-for-end ic-if-end>
                            <div class="tags has-addons">
                                <a class="tag is-medium" ic-click="addTag:{{ k }}">
                                    <span class="icon is-medium"><i class="fas fa-file-medical"></i></span>
                                </a>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>

</div>
</body>
</html>
