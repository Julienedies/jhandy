<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>rp</title>
    <link rel="stylesheet" href="../../css/vendor/bulma/bulma.css">
    <link rel="stylesheet" href="../../css/vendor/effeckt/animations.css">
    <script src="/set_node_modules_path.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
<div ic-view-stage ic-ctrl="mainCtrl">

    <div id="todoList" class="-shrink" ic-ctrl="todoListCtrl" ic-view="todoList" ic-active>
        <div class="column">

            <header id="mainHeader" ic-tpl="types">
                <div class="field is-grouped is-grouped-centered is-grouped-multiline">
                    <div class="control">
                        <div class="buttons is-centered" ic-select="tags" ic-select-auto="false" ic-select-cla="is-primary"
                             ic-has-selected="v==model.filterByType" ic-select-on-change="onFilterKeyChange">

                            <button ic-for="v,i in model.mapByType" ic-select-item ic-val="{{ v }}"
                                    ic-class="button is-small {{ v==model.filterByType?'is-primary':''  }}">
                                {{ RPMQS_MAP[v] }}
                            </button>

                            <button ic-select-item ic-val="Re" ic-class="button is-small {{ model.filterByType==='Re'?'is-primary':''  }}">
                                Re
                            </button>

                            <button class="button is-primary is-small" ic-click="addTodo">新Item</button>

                            <button class="button is-primary is-small" ic-click="toggleForm">显示表单</button>
                            <button class="button is-primary is-small" ic-click="toggleText">展开模式</button>
                        </div>
                    </div>

                </div>
            </header>

            <div id="mainContent" ic-tpl="todoList">
                <div ic-form="rp" ic-init="rpList=model.rpList; rpForm=model.rpForm;">
                    <ul>
                        <li class="box" ic-for="i,v in rpList" data-id="{{ v.id }}" id="{{ 'k'+v.id }}" draggable="true" ic-dragstart="dragstart"
                            ic-drop="drop" ic-dragover="dragover" ic-dragleave="dragleave">

                            <header ic-click="toggle" ic-class="role_{{ v.role }}">
                                <h3>{{ v.title }} <b>{{ v.caution }} </b></h3>
                                <h5 class="caution" ic-if="v.caution"></h5>
                            </header>

                            <div class="wrap">

                                <div class="field is-grouped is-grouped-multiline" ic-if="v.tags && v.tags.length"
                                     ic-select
                                     ic-select-cla="is-info"
                                     ic-select-type="checkbox"
                                     ic-select-item=".tag"
                                     ic-form-field="{{ 'k_'+v.id }}">

                                    <div class="control" ic-for="j,k in v.tags">
                                        <div class="tags has-addons" ic-init="o=TAGS_MAP_BY_ID[k]">
                                            <span class="tag is-medium" ic-if-start="o.type==='交易错误'||o.type==='要解决的问题'" ic-val="{{ k }}">
                                                {{ o.text }}
                                            </span>
                                            <span class="tag is-medium" ic-else-if="o.type==='交易要素'" ic-val="{{ k }}">
                                                {{ o.text }}
                                            </span>
                                            <span class="tag is-medium" ic-else ic-val="{{ k }}">
                                                {{ o.text }}
                                            </span>
                                        </div>
                                    </div>

                                </div>

                                <h6 class="comment" ic-if="v.comment" style="padding: 0.1em"> {{ v.comment }} </h6>

                                <div style="padding-bottom: 0.5em;" ic-if="v.role==9">
                                    <textarea class="textarea is-medium" ic-form-field="{{ 'k_'+v.id }}" rows="1">{{ rpForm[v.id] }}</textarea>
                                </div>


                                <div class="pre text" ic-dblclick="toggle">{{ v.content }}</div>

                                <div style="padding: 2px 0;">
                                    <div class="tags is-right">
                                        <span class="tag is-small"> {{ v.level || 0 }}</span>
                                        <span class="tag is-small"> {{ v.type }}</span>
                                        <span class="tag is-small" ic-click="edit:{{ v.id }}">修改</span>
                                        <span class="tag is-small" ic-click="plus:{{ v.id }}">加权</span>
                                        <!--<span class="tag is-small" ic-click="focus:{{ v.id }}">置顶</span>-->
                                        <span class="tag is-small" ic-click="re:{{ v.id }}" ic-if="v.type!=='re'">Re</span>
                                        <span class="tag is-small"
                                              ic-ajax
                                              ic-submit-method="delete"
                                              ic-submit-action="/stock/rp/{{v.id}}"
                                              ic-submit-before="delBeforeConfirm"
                                              ic-submit-on-done="onDelDone">删除</span>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>

                    <footer id="mainFooter">
                        <div>
                            <div>
                                <div class="field is-grouped">
                                    <div class="control">阶段变量</div>
                                    <div class="control is-expanded">
                                        <textarea class="textarea" ic-form-field="阶段变量" rows="6">{{ rpForm['阶段变量'] }}</textarea>
                                    </div>
                                </div>

                                <div class="field is-grouped is-grouped-centered">
                                    <div class="control">交易计划</div>
                                    <div class="control is-expanded">
                                        <textarea id="rpPlanItem" class="textarea" ic-form-field="交易计划" ic-field-rule="required" rows="20">{{ rpForm['交易计划'] }}</textarea>
                                    </div>
                                </div>

                                <div class="field is-grouped is-grouped-centered">
                                    <div class="control">
                                        <input class="input is-small" type="date" name="date" ic-form-field ic-value="{{model.date || formatDate2() }}">
                                    </div>
                                    <div class="control">
                                        <button class="button is-primary is-small"
                                                ic-form-submit="rp"
                                                ic-submit-action="/stock/replay"
                                                ic-submit-before="replay.before"
                                                ic-submit-on-done="replay.done">
                                            保存
                                        </button>
                                    </div>
                                    <div class="control">
                                        <button class="button is-primary is-small" ic-click="reset">
                                            重置
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </footer>

                </div>
            </div>

        </div>
    </div>

    <div ic-view="setTodo" ic-ctrl="setTodoCtrl">
        <div class="column">
            <div ic-tpl="setTodo" ic-tpl-init="{}">
                <div ic-form>

                    <div class="field has-addons">
                        <div class="control">
                            <button class="button is-info">标题</button>
                        </div>
                        <div class="control is-expanded">
                            <input class="input" type="text" placeholder="Text input" value="{{ model.title }}" ic-form-field="title">
                            <input type="hidden" value="{{ model.id }}" ic-form-field="id">
                        </div>
                        <p class="control">
                            <span class="select">
                              <select name="type" ic-form-field>
                                  <option ic-for="i,o in TAGS_MAP['rpmqs']" value="{{o.key}}" ic-has-selected="o.key==model.type">
                                      {{ o.text }}
                                  </option>
                                  <!-- <option value="rp" ic-has-selected="'rp'==model.type">复盘&计划</option>
                                   <option value="question" ic-has-selected="'question'==model.type">问题</option>
                                   <option value="mistake" ic-has-selected="'mistake'==model.type">错误</option>
                                   <option value="warn" ic-has-selected="'warn'==model.type">警告</option>
                                   <option value="idea" ic-has-selected="'idea'==model.type">理念</option>
                                   <option value="市场" ic-has-selected="'市场'==model.type">市场</option>-->
                              </select>
                            </span>
                        </p>
                    </div>

                    <div class="field has-addons">
                        <div class="control">
                            <button class="button is-info">提醒</button>
                        </div>
                        <div class="control is-expanded">
                            <input class="input" type="text" placeholder="Text input" value="{{ model.caution }}" ic-form-field="caution">
                        </div>
                    </div>

                    <div class="field has-addons">
                        <div class="control">
                            <button class="button is-info">备注</button>
                        </div>
                        <div class="control is-expanded">
                            <input class="input" type="text" placeholder="Text input" value="{{ model.comment }}" ic-form-field="comment">
                        </div>
                    </div>

                    <div class="field is-grouped is-grouped-multiline" ic-select="items" ic-select-type="checkbox" ic-form-field="tags">
                        <div class="control" ic-for="i,v in model.tags">
                            <div class="tags has-addons">
                            <span class="tag is-medium" ic-select-item ic-val="{{ v }}" selected>
                                {{ TAGS_MAP_BY_ID[v].text }}
                            </span>
                            </div>
                        </div>

                        <p class="control"> <!-- ic-view-to="tags" -->
                            <button class="button is-primary is-fullwidth" ic-popup-target="selectTags">
                                添加新项
                            </button>
                        </p>
                    </div>

                    <div class="field has-addons">
                        <div class="control" style="width:64%;">
                            <button class="button is-primary"
                                    style="width:300px;"
                                    ic-form-submit
                                    ic-submit-action="/stock/rp"
                                    ic-submit-before="before"
                                    ic-submit-on-done="done">保存
                            </button>
                            <button class="button" ic-click="reset" style="width:100px;">
                                重置
                            </button>
                            <button class="button" ic-click="cancel" style="width:100px;">取消</button>
                            <button class="button" ic-view-to="todoList" style="width:220px;">
                                返回
                            </button>
                        </div>

                        <div class="control" style="width:10px;"></div>
                        <div class="control">
                            <button class="button">level</button>
                        </div>
                        <div class="control">
                            <input class="input" type="number" step="5" name="level" ic-form-field ic-value="{{ model.level||1 }}">
                        </div>
                        <div class="control">
                            <button class="button">role</button>
                        </div>
                        <div class="control">
                            <p class="select">
                                <select name="role" ic-form-field>
                                    <option value="0" ic-has-selected="model.role==0">问题&错误</option>
                                    <option value="1" ic-has-selected="model.role==1">复盘思考</option>
                                    <option value="2" ic-has-selected="model.role==2">关键理念</option>
                                    <option value="3" ic-has-selected="model.role==3">错误&警告</option>
                                </select>
                            </p>
                        </div>
                        <div class="control" style="width:100px;"></div>
                        <div class="control">

                        </div>
                    </div>

                    <div class="field">
                        <div class="control">
                            <textarea id="editor" rows="14" class="textarea" placeholder="内容" ic-form-field="content"></textarea>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    ${ require('../tags/select-tags.html') }
    ${ require('../tags/set-tag.html') }
</div>
</body>
</html>
